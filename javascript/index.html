<!DOCTYPE html>
<html>
    <head>
    	<meta charset="UTF-8">
        <title>bem^templates – HTML template engine with BEM in mind</title>
        <script type="text/javascript" src="bemt1.js"></script>


        <link rel="stylesheet" type="text/css" href="test/jasmine/lib/jasmine-core/jasmine.css">
		<script type="text/javascript" src="test/jasmine/lib/jasmine-core/jasmine.js"></script>
		<script type="text/javascript" src="test/jasmine/lib/jasmine-core/jasmine-html.js"></script>
		<script type="text/javascript" src="test/jasmine/lib/jasmine-core/boot.js"></script>
    </head>
    <body>
	    <script type="text/javascript">

			describe("Tree Parser", function() {
				it("can follow simple nesting", function() {
					var result = bemt.parseTree('section\n  div\n    p\n      span');
					var correct = [
						{
							string : 'section',
							children : [
								{
									string : 'div',
									children : [
										{
											string : 'p',
											children : [
												{ string : 'span' }
											]
										}
									]
								}
							]
						}
					];
					expect(result).toEqual(correct);
				});

				it("skips empty lines", function() {
					var result = bemt.parseTree('section\n\n  div\n\nsection');
					var correct = [
						{
							string: 'section',
							children: [
								{ string: 'div' }
							]
						},
						{ string : 'section' }
					]
					expect(result).toEqual(correct);
				});

				it("can ignore offset of the first level nodes", function() {
					var result = bemt.parseTree(' section\n   div\n section\nsection');
					var correct = [
						{
							string: 'section',
							children: [
								{ string: 'div' }
							]
						},
						{ string : 'section' },
						{ string : 'section' }
					]
					expect(result).toEqual(correct);
				});

				it("understands both tabs and spaces for offset, even mixed", function() {
					var result = bemt.parseTree('section\n \tdiv\n \t  | text\n  div\nsection');
					var correct = [
						{
							string: 'section',
							children: [
								{
									string: 'div',
									children: [
										{ string: '| text' }
									]
								},
								{ string: 'div' }
							]
						},
						{ string : 'section' }
					]
					expect(result).toEqual(correct);
				});

				it("does inline split with proper siblings and children handling", function() {
					var result = bemt.parseTree('section\n  div | a @href="/" | span "text | with | pipes"\n    | new line text\n  div\nsection');
					var correct = [
						{
							string: 'section',
							children: [
								{
									string: 'div',
									children: [
										{
											string: 'a @href="/"',
											children: [
												{
													string: 'span "text | with | pipes"',
													children: [
														{ string: '| new line text' }
													]
												}
											]
										}
									]
								},
								{ string: 'div' }
							]
						},
						{ string : 'section' }
					]
					expect(result).toEqual(correct);
				});
			});


			describe("Line Parser", function() {
			});


			describe("JSON->HTML Composer", function() {
				it("generates an html element", function() {
					var result = bemt.json2html({
						"t": "title",
					});
					var correctAnswer = '<title></title>';
					expect(result).toEqual(correctAnswer);
				});

				it("generates an html element with text content", function() {
					var result = bemt.json2html({
						"t": "title",
						"c": "Hello, World!"
					});
					var correctAnswer = '<title>Hello, World!</title>';
					expect(result).toEqual(correctAnswer);
				});

				it("can build a simplest “Hello, World!” document", function() {
					var result = bemt.json2html({
						"t": "html",
						"c": [
							{
								"t": "body",
								"c": [
									{
										"t": "h1",
										"c": "Hello, World!"
									},
								]
							},
						]
					});
					var correctAnswer = '<html><body><h1>Hello, World!</h1></body></html>';
					expect(result).toEqual(correctAnswer);
				});

				it("omits closing tags on empty elements", function() {
					var result = bemt.json2html({
						"t": "wbr"
					});
					var correctAnswer = '<wbr>';
					expect(result).toEqual(correctAnswer);
				});

				it("adds non-bem attributes", function() {
					var result = bemt.json2html({
						"t": "base",
						"a": {
							"href": "http://ya.ru/",
							"target": "_blank"
						}
					});
					var correctAnswer = '<base href="http://ya.ru/" target="_blank">';
					expect(result).toEqual(correctAnswer);
				});

				it("replaces non-bem attributes", function() {
					var result = bemt.json2html({
						"t": "base",
						"a": {
							"href": "http://ya.ru/",
							"target": "_blank"
						},
						"c": [
							{
								"a": {
									"href": "http://yandex.ru/search?q=123"
								}
							}
						]
					});
					var correctAnswer = '<base href="http://yandex.ru/search?q=123" target="_blank">';
					expect(result).toEqual(correctAnswer);
				});

				it("appends non-bem attributes", function() {
					var result = bemt.json2html({
						"t": "base",
						"a": {
							"href": "http://ya.ru/",
							"target": "_blank"
						},
						"c": [
							{
								"a": {
									"href=+": "search?q=123"
								}
							}
						]
					});
					var correctAnswer = '<base href="http://ya.ru/search?q=123" target="_blank">';
					expect(result).toEqual(correctAnswer);
				});

				it("appends class value separated by space", function() {
					var result = bemt.json2html({
						"t": "h1",
						"a": {
							"class": "title",
						},
						"c": [
							{
								"a": {
									"class=+": "blue"
								},
								"c": "Hello, World!"
							}
						]
					});
					var correctAnswer = '<h1 class="title blue">Hello, World!</h1>';
					expect(result).toEqual(correctAnswer);
				});

				it("removes attribute value separated by space", function() {
					var result = bemt.json2html({
						"t": "h1",
						"a": {
							"class": "title blue",
						},
						"c": [
							{
								"a": {
									"class=-": "blue"
								},
								"c": "Hello, World!"
							}
						]
					});
					var correctAnswer = '<h1 class="title">Hello, World!</h1>';
					expect(result).toEqual(correctAnswer);
				});

				it("generates a block with elements", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"c": "Тело новости"
							}
						]
					});
					var correctAnswer = '<article class="article"><h1 class="article__title">Заголовок</h1><div class="article__body">Тело новости</div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("generates two blocks, one within another", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"c": "Тело новости"
									}
								]
							}
						]
					});
					var correctAnswer = '<article class="article"><h1 class="article__title">Заголовок</h1><div class="article__body"><div class="ugc">Тело новости</div></div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("applies a modifier param to the block and it's elements", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"m": ["theme"],
								"c": "Тело новости"
							}
						]
					}, {
						"mods": {
							"theme": "winter"
						}
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="article__body article__body_theme_winter">Тело новости</div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("applies a modifier param to the child blocks", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"m": ["theme"],
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"m": ["theme"],
										"c": "Тело новости"
									}
								]
							}
						]
					}, {
						"mods": {
							"theme": "winter"
						}
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="article__body article__body_theme_winter"><div class="ugc ugc_theme_winter">Тело новости</div></div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("applies internal modifier", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"mods": {
							"theme": "winter"
						},
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"m": ["theme"],
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"m": ["theme"],
										"c": "Тело новости"
									}
								]
							}
						]
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="article__body article__body_theme_winter"><div class="ugc ugc_theme_winter">Тело новости</div></div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("rewrites nested internal modifier", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"mods": {
							"theme": "winter"
						},
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"m": ["theme"],
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"m": ["theme"],
										"mods": {
											"theme": "summer"
										},
										"c": "Тело новости"
									}
								]
							}
						]
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="article__body article__body_theme_winter"><div class="ugc ugc_theme_summer">Тело новости</div></div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("rewrites nested modifier from params", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"m": ["theme"],
								"mods": {
									"theme": "summer"
								},
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"m": ["theme"],
										"c": "Тело новости"
									}
								]
							}
						]
					}, {
						"mods": {
							"theme": "winter"
						}
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="article__body article__body_theme_summer"><div class="ugc ugc_theme_summer">Тело новости</div></div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("rewrites modifier in separate element (like changing by the test function)", function() {
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"m": ["theme"],
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"mods": {
									"theme": "summer"
								},
								"c": [
									{
										"b": "ugc",
										"t": "div",
										"m": ["theme"],
										"c": "Тело новости"
									}
								]
							}
						]
					}, {
						"mods": {
							"theme": "winter"
						}
					});
					var correctAnswer = '<article class="article article_theme_winter"><h1 class="article__title">Заголовок</h1><div class="ugc ugc_theme_summer">Тело новости</div></article>';
					expect(result).toEqual(correctAnswer);
				});

				it("output with identation", function() {
					bemt.set({
						'indent': true,
						'indentSize': '  '
					})
					var result = bemt.json2html({
						"b": "article",
						"t": "article",
						"c": [
							{
								"e": "title",
								"t": "h1",
								"c": "Заголовок"
							},
							{
								"e": "body",
								"t": "div",
								"c": "Тело новости"
							}
						]
					});
					var correctAnswer = '<article class="article">\n  <h1 class="article__title">Заголовок</h1>\n  <div class="article__body">\n    Тело новости\n  </div>\n</article>\n';
					console.log(result);
					expect(result).toEqual(correctAnswer);
				});

			});

	    </script>

    </body>
</html>